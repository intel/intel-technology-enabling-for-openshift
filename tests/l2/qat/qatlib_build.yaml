# Copyright (c) 2023 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

apiVersion: image.openshift.io/v1
kind: ImageStream
metadata:
  name: intel-qat-workload
  namespace: intel-qat
spec: {}
---
apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: intel-qat-workload
  namespace: intel-qat
spec:
  triggers:
    - type: "ConfigChange"
    - type: "ImageChange"
  runPolicy: "Serial"
  source:
    type: Dockerfile
    dockerfile: |
        
          ARG BUILDER=registry.access.redhat.com/ubi9-minimal:latest
          FROM ${BUILDER} 
          RUN microdnf -y update && \
            microdnf install -y qatlib-tests qatlib-devel qatlib --enablerepo=codeready-builder-for-rhel-9-x86_64-rpms
          
  strategy:
    type: Docker
    noCache: true
    dockerStrategy:
      buildArgs:
        - name: "BUILDER"
          value: "registry.access.redhat.com/ubi9-minimal:9.2"
      volumes:
      - name: etc-pki-entitlement
        mounts:
        - destinationPath: /etc/pki/entitlement
        source:
          type: Secret
          secret:
            secretName: etc-pki-entitlement
  output:
    to:
      kind: ImageStreamTag
      name: intel-qat-workload:latest